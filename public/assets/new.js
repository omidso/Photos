function processPage(i){lastWidth=$("#rowholder").innerWidth()-9,$(".picrow").width(lastWidth),$(".picrow").children().remove(),processAlbums(i)}function processAlbums(i){var r=$(".picrow"),a=r.eq(0).innerWidth(),t=220,e=5,h=[];$.each(i,function(i,r){var a=r.width,e=r.height;e!=t&&(a=Math.floor(a*(t/e))),h.push(a)});for(var n=0,o=0,d=h.length;d>0;){o==r.length&&($("#rowholder").append('<div class="picrow"></div>'),$(".picrow").width(a-9),r=$(".picrow"));var l=r.eq(o++);l.children().remove();for(var c=0,s=0;a>c&&d;)c+=h[n+s++]+2*e,d--;var u=1,p=220;d>0&&(u=a/c,p=Math.min(t,Math.floor(t*u)));var f=0;for(c=0;s>f;){var v=i[n+f],w=Math.floor(h[n+f]*u);!function(){var i='<div class="picimage"'+v.data+' style="height:'+p+"px;width:"+w+"px;margin:"+e+"px;background-image:url("+v.imageurl+')"></div>',r=$(i),a=v.linkurl;r.click(function(){location.href=a}),l.append(r),r.append(v.info)}(),c+=w+2*e,f++}for(f=0;a>c&&d>0;){var g=l.find(".picimage:nth-child("+(f+1)+")");g.width(g.width()+1),f=(f+1)%s,c++}for(f=0;c>a-9;){var m=l.find(".picimage:nth-child("+(f+1)+")");m.width(m.width()-1),f=(f+1)%s,c--}l.height(p+2*e),l.show(),n+=s}for(;o<r.length;)r.eq(o++).hide()}var lastWidth=0;$(function(){var i=[];$.getJSON("/album/recent.json",function(r){$.each(r,function(){var r=this;i.push({imageurl:r.url,width:r.urlwidth,height:r.urlheight,info:'<div class="picinfo">'+r.name+"<br>"+r.albumdatestr+"</div>",linkurl:"/albums/"+r.id,data:" data-name="+r.onlinename+" data-authkey="+r.authkey})}),processPage(i)}),$(window).resize(function(){var r=$("#rowholder").innerWidth();(lastWidth>r||r>lastWidth)&&processPage(i)})});