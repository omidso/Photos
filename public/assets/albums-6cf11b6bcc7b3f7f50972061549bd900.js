function GalleriaDataFromJSON(a){var t=0,e=[];return $.each(a,function(){var a=this,i="<div> Focal Length: "+a.focallength+" mm f/"+a.fstop+"<br>"+"Exposure: "+a.exposure+"s"+"<br>"+"ISO: "+a.iso+"<br>"+"Flash: "+a.flash+"<br>"+"Camera make: "+a.make+"<br>"+"Camera model: "+a.model+"<br></div>";e[t++]={thumb:a.thumburl,image:a.url,big:a.bigurl,title:a.name,description:i,photoid:a.id,albumid:a.album_id}}),e}function GalleriaManageFaces(){$(".galleria-info-faces").click(function(){if("true"==$(this).attr("data-active"))$(this).css("background-color","#000000"),$(this).attr("data-active",!1),$(".facebox").remove();else{$(this).css("background-color","#4b698c"),$(this).attr("data-active",!0);var a=Galleria.get(0),t=a.getData().albumid+":"+a.getData().photoid;$.getJSON("/photo/people.json",{q:t},function(t){if(t.people.length){var e=0;$.each(t.people,function(){var i,o,r,n,h=a.getActiveImage().height,s=a.getActiveImage().width,l=a.getActiveImage().x,c=a.getActiveImage().y;t.orientation<=1||3==t.orientation?(n=s/t.width,r=h/t.height,fw=t.faces[e].width*n,fh=t.faces[e].height*r,t.orientation<=1?(i=parseInt(c+t.faces[e].yloc*n),o=parseInt(l+t.faces[e].xloc*r)):(i=ParseInt(c+(h-(fh+t.faces[e].yloc*r))),o=ParseInt(l+(s-(fw+t.faces[e].xloc*n))))):(2==t.orientation||4==t.orientation)&&(n=s/t.height,r=h/t.width,fw=t.faces[e].height*n,fh=t.faces[e].width*r,2==t.orientation?(i=parseInt(c+t.faces[e].xloc*r),o=parseInt(l+(s-(fw+t.faces[e].yloc*n)))):(i=parseInt(c+(h-(fh+t.faces[e].xloc*r))),o=parseInt(l+t.faces[e].yloc*n)));var d='<a href="/people/'+this.id+'/photos ">'+this.name+"</a>",p='<div class="facebox" style= "width: '+fw+"px; height: "+fh+"px;"+"top: "+i+"px;"+"left: "+o+'px;"'+'><span class= "label" style="position: relative; top:-20px">'+d+"</span></div>";$(".page-container").append(p),e++})}})}})}function processPage(a){lastWidth=$("#rowholder").innerWidth()-9,$(".picrow").width(lastWidth),$(".picrow").children().remove(),processAlbums(a)}function processAlbums(a){var t=$(".picrow"),e=t.eq(0).innerWidth(),i=220,o=5,r=[];$.each(a,function(a,t){var e=t.width,o=t.height;o!=i&&(e=Math.floor(e*(i/o))),r.push(e)});for(var n=0,h=0,s=r.length;s>0;){h==t.length&&($("#rowholder").append('<div class="picrow"></div>'),$(".picrow").width(e-9),t=$(".picrow"));var l=t.eq(h++);l.children().remove();for(var c=0,d=0;e>c&&s;)c+=r[n+d++]+2*o,s--;var p=1,f=220;s>0&&(p=e/c,f=Math.min(i,Math.floor(i*p)));var g=0;for(c=0;d>g;){var u=a[n+g],v=Math.floor(r[n+g]*p);!function(){var a='<div class="picimage"'+u.data+' style="height:'+f+"px;width:"+v+"px;margin:"+o+"px;background-image:url("+u.imageurl+')"></div>',t=$(a),e=u.linkurl;t.click(function(){location.href=e}),l.append(t),t.append(u.info)}(),c+=v+2*o,g++}for(g=0;e>c&&s>0;){var m=l.find(".picimage:nth-child("+(g+1)+")");m.width(m.width()+1),g=(g+1)%d,c++}for(g=0;c>e-9;){var w=l.find(".picimage:nth-child("+(g+1)+")");w.width(w.width()-1),g=(g+1)%d,c--}l.height(f+2*o),l.show(),n+=d}for(;h<t.length;)t.eq(h++).hide()}var lastWidth=0;$(function(){if(page=$(".this-page").attr("data-type"),"all albums"==page){var a=[];$.getJSON("/albums.json",function(t){$.each(t,function(){var t=this;a.push({imageurl:t.url,width:t.urlwidth,height:t.urlheight,info:'<div class="picinfo">'+t.name+"<br>"+t.albumdatestr+"</div>",linkurl:"/albums/"+t.id,data:" data-name="+t.onlinename+" data-authkey="+t.authkey})}),processPage(a)}),$(window).resize(function(){var t=$("#rowholder").innerWidth();(lastWidth>t||t>lastWidth)&&processPage(a)})}else{var t=$(".this-page").attr("data-id"),e=[];$.getJSON("/album/photos.json",{id:t},function(a){$.each(a,function(){var a=this;e.push({imageurl:a.url,width:a.width,height:a.height,info:'<div class="picinfo">'+a.name+"</div>",linkurl:"/photos/"+a.id,data:" data-name="+a.onlinename+" data-authkey="+"auth"})}),processPage(e)}),$(window).resize(function(){var a=$("#rowholder").innerWidth();(lastWidth>a||a>lastWidth)&&processPage(e)})}});