function GalleriaDataFromJSON(e){var t=0,a=[];return $.each(e,function(){var e=this,i="<div> Focal Length: "+e.focallength+" mm f/"+e.fstop+"<br>"+"Exposure: "+e.exposure+"s"+"<br>"+"ISO: "+e.iso+"<br>"+"Flash: "+e.flash+"<br>"+"Camera make: "+e.make+"<br>"+"Camera model: "+e.model+"<br></div>";a[t++]={thumb:e.thumburl,image:e.url,big:e.bigurl,title:e.name,description:i,photoid:e.id,albumid:e.album_id}}),a}function GalleriaManageFaces(){$(".galleria-info-faces").click(function(){if("true"==$(this).attr("data-active"))$(this).css("background-color","#000000"),$(this).attr("data-active",!1),$(".facebox").remove();else{$(this).css("background-color","#4b698c"),$(this).attr("data-active",!0);var e=Galleria.get(0),t=e.getData().albumid+":"+e.getData().photoid;$.getJSON("/photo/people.json",{q:t},function(t){if(t.people.length){var a=0;$.each(t.people,function(){var i,o,r,n,l=e.getActiveImage().height,c=e.getActiveImage().width,h=e.getActiveImage().x,s=e.getActiveImage().y;t.orientation<=1||3==t.orientation?(n=c/t.width,r=l/t.height,fw=t.faces[a].width*n,fh=t.faces[a].height*r,t.orientation<=1?(i=parseInt(s+t.faces[a].yloc*n),o=parseInt(h+t.faces[a].xloc*r)):(i=ParseInt(s+(l-(fh+t.faces[a].yloc*r))),o=ParseInt(h+(c-(fw+t.faces[a].xloc*n))))):(2==t.orientation||4==t.orientation)&&(n=c/t.height,r=l/t.width,fw=t.faces[a].height*n,fh=t.faces[a].width*r,2==t.orientation?(i=parseInt(s+t.faces[a].xloc*r),o=parseInt(h+(c-(fw+t.faces[a].yloc*n)))):(i=parseInt(s+(l-(fh+t.faces[a].xloc*r))),o=parseInt(h+t.faces[a].yloc*n)));var p='<a href="/people/'+this.id+'/photos ">'+this.name+"</a>",d='<div class="facebox" style= "width: '+fw+"px; height: "+fh+"px;"+"top: "+i+"px;"+"left: "+o+'px;"'+'><span class= "label" style="position: relative; top:-20px">'+p+"</span></div>";$(".page-container").append(d),a++})}})}})}function processPage(e){lastWidth=$("#rowholder").innerWidth()-9,$(".picrow").width(lastWidth),$(".picrow").children().remove(),processAlbums(e)}function processAlbums(e){var t=$(".picrow"),a=t.eq(0).innerWidth(),i=220,o=5,r=[];$.each(e,function(e,t){var a=t.width,o=t.height;o!=i&&(a=Math.floor(a*(i/o))),r.push(a)});for(var n=0,l=0,c=r.length;c>0;){l==t.length&&($("#rowholder").append('<div class="picrow"></div>'),$(".picrow").width(a-9),t=$(".picrow"));var h=t.eq(l++);h.children().remove();for(var s=0,p=0;a>s&&c;)s+=r[n+p++]+2*o,c--;var d=1,f=220;c>0&&(d=a/s,f=Math.min(i,Math.floor(i*d)));var u=0;for(s=0;p>u;){var g=e[n+u],v=Math.floor(r[n+u]*d);!function(){var e='<div class="picimage"'+g.data+' style="height:'+f+"px;width:"+v+"px;margin:"+o+"px;background-image:url("+g.imageurl+')"></div>',t=$(e),a=g.linkurl;t.click(function(){location.href=a}),h.append(t),t.append(g.info)}(),s+=v+2*o,u++}for(u=0;a>s&&c>0;){var m=h.find(".picimage:nth-child("+(u+1)+")");m.width(m.width()+1),u=(u+1)%p,s++}for(u=0;s>a-9;){var w=h.find(".picimage:nth-child("+(u+1)+")");w.width(w.width()-1),u=(u+1)%p,s--}h.height(f+2*o),h.show(),n+=p}for(;l<t.length;)t.eq(l++).hide()}function GetPeopleAndProcess(e){people=[],$.getJSON(e,function(e){$.each(e,function(){var e=this.person,t=this.count;t>0&&e.url&&people.push({imageurl:e.url,width:e.urlwidth,height:e.urlheight,info:'<div class="picinfo">'+e.name+"<br>"+t+"</div>",linkurl:"/people/"+e.id+"/photos",data:""})}),processPage(people)})}function SortByCount(){GetPeopleAndProcess("/people_by_photo_count.json")}function SortByName(){GetPeopleAndProcess("/people_by_name.json")}var lastWidth=0,gCurSort="count",people=[];$(function(){if(page=$(".this-page").attr("data-type"),"all people"==page)gCurSort="count",SortByCount(),$(window).resize(function(){var e=$("#rowholder").innerWidth();(lastWidth>e||e>lastWidth)&&processPage(people)}),$("#alpha").click(function(){"alpha"!=gCurSort&&(gCurSort="alpha",SortByName())}),$("#count").click(function(){"count"!=gCurSort&&(gCurSort="count",SortByCount())});else{var e=$("#galleria").attr("data-name");$.getJSON("/person/photos.json",{q:e},function(e){e.length&&(picData=GalleriaDataFromJSON(e),Galleria.configure({lightbox:!0}),Galleria.run("#galleria",{dataSource:picData}))}),Galleria.ready(function(){GalleriaManageFaces()})}});