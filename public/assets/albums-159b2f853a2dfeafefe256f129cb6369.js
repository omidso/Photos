function GalleriaDataFromJSON(a){var e=0,i=[];return $.each(a,function(){var a=this,t="<div> Focal Length: "+a.focallength+" mm f/"+a.fstop+"<br>"+"Exposure: "+a.exposure+"s"+"<br>"+"ISO: "+a.iso+"<br>"+"Flash: "+a.flash+"<br>"+"Camera make: "+a.make+"<br>"+"Camera model: "+a.model+"<br></div>";i[e++]={thumb:a.thumburl,image:a.url,big:a.bigurl,title:a.name,description:t,photoid:a.id,albumid:a.album_id}}),i}function GalleriaManageFaces(){$(".galleria-info-faces").click(function(){if("true"==$(this).attr("data-active"))$(this).css("background-color","#000000"),$(this).attr("data-active",!1),$(".facebox").remove();else{$(this).css("background-color","#4b698c"),$(this).attr("data-active",!0);var a=Galleria.get(0),e=a.getData().albumid+":"+a.getData().photoid;$.getJSON("/photo/people.json",{q:e},function(e){if(e.people.length){var i=0;$.each(e.people,function(){var t,o,r,h,n=a.getActiveImage().height,s=a.getActiveImage().width,l=a.getActiveImage().x,c=a.getActiveImage().y;e.orientation<=1||3==e.orientation?(h=s/e.width,r=n/e.height,fw=e.faces[i].width*h,fh=e.faces[i].height*r,e.orientation<=1?(t=parseInt(c+e.faces[i].yloc*h),o=parseInt(l+e.faces[i].xloc*r)):(t=ParseInt(c+(n-(fh+e.faces[i].yloc*r))),o=ParseInt(l+(s-(fw+e.faces[i].xloc*h))))):(2==e.orientation||4==e.orientation)&&(h=s/e.height,r=n/e.width,fw=e.faces[i].height*h,fh=e.faces[i].width*r,2==e.orientation?(t=parseInt(c+e.faces[i].xloc*r),o=parseInt(l+(s-(fw+e.faces[i].yloc*h)))):(t=parseInt(c+(n-(fh+e.faces[i].xloc*r))),o=parseInt(l+e.faces[i].yloc*h)));var d='<a href="/people/'+this.id+'/photos ">'+this.name+"</a>",p='<div class="facebox" style= "width: '+fw+"px; height: "+fh+"px;"+"top: "+t+"px;"+"left: "+o+'px;"'+'><span class= "label" style="position: relative; top:-20px">'+d+"</span></div>";$(".page-container").append(p),i++})}})}})}function processPage(a){lastWidth=$("#rowholder").innerWidth()-9,$(".picrow").width(lastWidth),$(".picrow").children().remove(),processAlbums(a)}function processAlbums(a){var e=$(".picrow"),i=e.eq(0).innerWidth(),t=220,o=5,r=[];$.each(a,function(a,e){var i=e.width,o=e.height;o!=t&&(i=Math.floor(i*(t/o))),r.push(i)});for(var h=0,n=0,s=r.length;s>0;){n==e.length&&($("#rowholder").append('<div class="picrow"></div>'),$(".picrow").width(i-9),e=$(".picrow"));var l=e.eq(n++);l.children().remove();for(var c=0,d=0;i>c&&s;)c+=r[h+d++]+2*o,s--;var p=1,f=220;s>0&&(p=i/c,f=Math.min(t,Math.floor(t*p)));var g=0;for(c=0;d>g;){var u=a[h+g],v=Math.floor(r[h+g]*p);!function(){var a='<div class="picimage"'+u.data+' style="height:'+f+"px;width:"+v+"px;margin:"+o+"px;background-image:url("+u.imageurl+')"></div>',e=$(a),i=u.linkurl;e.click(function(){location.href=i}),l.append(e),e.append(u.info)}(),c+=v+2*o,g++}for(g=0;i>c&&s>0;){var m=l.find(".picimage:nth-child("+(g+1)+")");m.width(m.width()+1),g=(g+1)%d,c++}for(g=0;c>i-9;){var w=l.find(".picimage:nth-child("+(g+1)+")");w.width(w.width()-1),g=(g+1)%d,c--}l.height(f+2*o),l.show(),h+=d}for(;n<e.length;)e.eq(n++).hide()}var lastWidth=0;$(function(){if(page=$(".this-page").attr("data-type"),"all albums"==page){var a=[];$.getJSON("/albums.json",function(e){$.each(e,function(){var e=this;a.push({imageurl:e.url,width:e.urlwidth,height:e.urlheight,info:'<div class="picinfo">'+e.name+"<br>"+e.albumdatestr+"</div>",linkurl:"/albums/"+e.id,data:" data-name="+e.onlinename+" data-authkey="+e.authkey})}),processPage(a)}),$(window).resize(function(){var e=$("#rowholder").innerWidth();(lastWidth>e||e>lastWidth)&&processPage(a)})}else{var e=$(".this-page").attr("data-id"),i=[];$.getJSON("/album/photos.json",{id:e},function(a){$.each(a,function(a,e){i.push({imageurl:e.thumburl,width:e.width,height:e.height,info:'<div class="picinfo">'+e.name+"</div>",linkurl:"/photos/"+e.id})}),processPage(i)}),$(window).resize(function(){var a=$("#rowholder").innerWidth();(lastWidth>a||a>lastWidth)&&processPage(i)})}});